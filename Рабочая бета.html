<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Среħа 2024 - Система управления документами</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: white;
            color: #007bff;
            border-bottom: 3px solid #007bff;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .table-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table th {
            background: #007bff;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
        }

        .table td {
            padding: 12px 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .invoice-items {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: #f8f9fa;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .delivery-item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .totals {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
        }

        .total-row.final {
            border-top: 2px solid #007bff;
            padding-top: 10px;
            font-weight: bold;
            font-size: 18px;
            color: #007bff;
        }

        .preview {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .preview h3 {
            margin-bottom: 20px;
            color: #007bff;
        }

        .company-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .invoice-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-confirmed {
            background: #d4edda;
            color: #155724;
        }

        .invoice-list {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .invoice-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s ease;
        }

        .invoice-item:hover {
            background: #f8f9fa;
        }

        .invoice-item:last-child {
            border-bottom: none;
        }

        .invoice-info {
            flex: 1;
        }

        .invoice-actions {
            display: flex;
            gap: 10px;
        }

        .btn-confirm {
            background: #28a745;
            color: white;
        }

        .btn-confirm:hover {
            background: #218838;
        }

        .btn-remove {
            background: #dc3545;
            color: white;
        }

        .btn-remove:hover {
            background: #c82333;
        }

        .export-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .pdf-preview {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .summary-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .table-stats {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .table-stats th,
        .table-stats td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .table-stats th {
            background: #007bff;
            color: white;
            font-weight: bold;
        }

        .table-stats tr:nth-child(even) {
            background: #f8f9fa;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .print-content, .print-content * {
                visibility: visible;
            }
            .print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Среħа 2024 ДОО</h1>
            <p>Система управления инвойсами и отпремницами</p>
            <p>Београд, Стари Град, Мајке Јевросиме 35 | МБ: 22019309 | ПИБ: 114407658</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('clients')">Клиенты</button>
            <button class="nav-tab" onclick="showTab('products')">Товары</button>
            <button class="nav-tab" onclick="showTab('invoice')">Создать инвойс</button>
            <button class="nav-tab" onclick="showTab('delivery')">Создать отпремницу</button>
            <button class="nav-tab" onclick="showTab('statistics')">Статистика продаж</button>
        </div>

        <!-- Клиенты -->
        <div id="clients" class="tab-content active">
            <h2>Управление клиентами</h2>
            
            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label>Название компании *</label>
                        <input type="text" id="clientName" placeholder="Название компании">
                    </div>
                    <div class="form-group">
                        <label>Матични број *</label>
                        <input type="text" id="clientMB" placeholder="Матични број">
                    </div>
                    <div class="form-group">
                        <label>ПИБ *</label>
                        <input type="text" id="clientPIB" placeholder="ПИБ">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label>Адрес *</label>
                        <textarea id="clientAddress" rows="3" placeholder="Полный адрес"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Контакт</label>
                        <input type="text" id="clientContact" placeholder="Телефон, email, etc.">
                    </div>
                    <div class="form-group">
                        <label>Банковский счет</label>
                        <input type="text" id="clientBank" placeholder="Номер банковского счета">
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="addClient()">Добавить клиента</button>
            <button class="btn btn-secondary" onclick="clearClientForm()">Очистить форму</button>
            
            <div class="table-container">
                <table class="table" id="clientsTable">
                    <thead>
                        <tr>
                            <th>Название</th>
                            <th>МБ</th>
                            <th>ПИБ</th>
                            <th>Адрес</th>
                            <th>Контакт</th>
                            <th>Банк</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Товары -->
        <div id="products" class="tab-content">
            <h2>Управление товарами</h2>
            
            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label>Код товара *</label>
                        <input type="text" id="productCode" placeholder="Например: GF-B-TG210">
                    </div>
                    <div class="form-group">
                        <label>Название товара *</label>
                        <input type="text" id="productName" placeholder="Например: Tieguanyin/Zeleni Čaj 210g">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label>Стоимость без НДС (RSD) *</label>
                        <input type="number" id="productPrice" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Категория</label>
                        <select id="productCategory">
                            <option value="">Выберите категорию</option>
                            <option value="Zeleni Čaj">Зеленый чай</option>
                            <option value="Crni Čaj">Черный чай</option>
                            <option value="Printing">Полиграфия</option>
                            <option value="Other">Другое</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="addProduct()">Добавить товар</button>
            <button class="btn btn-secondary" onclick="clearProductForm()">Очистить форму</button>
            
            <div class="table-container">
                <table class="table" id="productsTable">
                    <thead>
                        <tr>
                            <th>Код</th>
                            <th>Название</th>
                            <th>Цена (RSD)</th>
                            <th>Категория</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Создать инвойс -->
        <div id="invoice" class="tab-content">
            <h2>Создать инвойс</h2>
            
            <div class="company-info">
                <h3>Поставщик:</h3>
                <p><strong>Среħа 2024 ДОО Београд (Стари Град)</strong><br>
                Матични број: 22019309 | ПИБ: 114407658<br>
                Седиште: Београд, Стари Град, Мајке Јевросиме 35</p>
            </div>

            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label>Номер инвойса *</label>
                        <input type="text" id="invoiceNumber" placeholder="1-DDMMYYYY">
                    </div>
                    <div class="form-group">
                        <label>Дата *</label>
                        <input type="date" id="invoiceDate">
                    </div>
                    <div class="form-group">
                        <label>Срок оплаты *</label>
                        <input type="date" id="invoiceDueDate">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label>Клиент *</label>
                        <select id="invoiceClient">
                            <option value="">Выберите клиента</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Способ доставки</label>
                        <select id="invoiceDelivery">
                            <option value="сопствени превоз">Сопствени превоз</option>
                            <option value="курирска служба">Курирская служба</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>НДС (%)</label>
                        <select id="invoiceVAT">
                            <option value="0">0%</option>
                            <option value="20">20%</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="invoice-items">
                <h3>Товары</h3>
                <div id="invoiceItemsContainer">
                    <div class="item-row">
                        <div class="form-group">
                            <label>Товар</label>
                            <select class="invoice-product" onchange="updateInvoiceItemPrice(this)">
                                <option value="">Выберите товар</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Количество</label>
                            <input type="number" class="invoice-quantity" value="1" min="1" onchange="calculateInvoiceItemAmount(this)">
                        </div>
                        <div class="form-group">
                            <label>Цена (RSD)</label>
                            <input type="number" class="invoice-price" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label>Сумма (RSD)</label>
                            <input type="number" class="invoice-amount" step="0.01" readonly>
                        </div>
                        <div>
                            <button class="btn btn-danger" onclick="removeInvoiceItem(this)">Удалить</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-success" onclick="addInvoiceItem()">Добавить товар</button>
            </div>

            <div class="totals">
                <div class="total-row">
                    <span>Подтотал:</span>
                    <span id="invoiceSubtotal">0.00 RSD</span>
                </div>
                <div class="total-row">
                    <span>НДС:</span>
                    <span id="invoiceVATAmount">0.00 RSD</span>
                </div>
                <div class="total-row final">
                    <span>Итого:</span>
                    <span id="invoiceTotal">0.00 RSD</span>
                </div>
            </div>

            <button class="btn btn-primary" onclick="generateInvoice()">Сгенерировать инвойс</button>
            <button class="btn btn-success" onclick="generateDeliveryFromInvoice()">Создать отпремницу на основе инвойса</button>
            
            <div id="invoicePreview" class="preview" style="display: none;">
                <h3>Предпросмотр инвойса</h3>
                <div id="invoiceContent" class="print-content"></div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="printInvoice()">Печать / Сохранить PDF</button>
                    <button class="btn btn-confirm" onclick="confirmInvoice()">Утвердить инвойс</button>
                </div>
                <div id="invoiceConfirmMessage" style="display: none; margin-top: 15px;" class="alert alert-success">
                    Инвойс утвержден и добавлен в статистику продаж!
                </div>
            </div>
        </div>

        <!-- Создать отпремницу -->
        <div id="delivery" class="tab-content">
            <h2>Создать отпремницу</h2>
            
            <div class="company-info">
                <h3>Поставщик:</h3>
                <p><strong>Среħа 2024 ДОО Београд (Стари Град)</strong><br>
                Матични број: 22019309 | ПИБ: 114407658<br>
                Седиште: Београд, Стари Град, Мајке Јевросиме 35</p>
            </div>

            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label>Номер отпремницы *</label>
                        <input type="text" id="deliveryNumber" placeholder="1-DDMMYYYY">
                    </div>
                    <div class="form-group">
                        <label>Дата *</label>
                        <input type="date" id="deliveryDate">
                    </div>
                    <div class="form-group">
                        <label>Срок поставки *</label>
                        <input type="date" id="deliveryDueDate">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label>Клиент *</label>
                        <select id="deliveryClient">
                            <option value="">Выберите клиента</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Способ доставки</label>
                        <select id="deliveryMethod">
                            <option value="сопствени превоз">Сопствени превоз</option>
                            <option value="курирска служба">Курирская служба</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="invoice-items">
                <h3>Товары</h3>
                <div id="deliveryItemsContainer">
                    <div class="delivery-item-row">
                        <div class="form-group">
                            <label>Товар</label>
                            <select class="delivery-product">
                                <option value="">Выберите товар</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Количество</label>
                            <input type="number" class="delivery-quantity" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label>Единица</label>
                            <input type="text" class="delivery-unit" value="ком" readonly>
                        </div>
                        <div>
                            <button class="btn btn-danger" onclick="removeDeliveryItem(this)">Удалить</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-success" onclick="addDeliveryItem()">Добавить товар</button>
            </div>

            <button class="btn btn-primary" onclick="generateDelivery()">Сгенерировать отпремницу</button>
            
            <div id="deliveryPreview" class="preview" style="display: none;">
                <h3>Предпросмотр отпремницы</h3>
                <div id="deliveryContent" class="print-content"></div>
                <button class="btn btn-primary" onclick="printDelivery()">Печать / Сохранить PDF</button>
            </div>
        </div>

        <!-- Статистика продаж -->
        <div id="statistics" class="tab-content">
            <h2>Статистика продаж</h2>
            
            <div class="filter-section">
                <h3>Фильтры</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Период с:</label>
                        <input type="date" id="statsFromDate">
                    </div>
                    <div class="form-group">
                        <label>Период по:</label>
                        <input type="date" id="statsToDate">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <div>
                            <button class="btn btn-primary" onclick="updateStatistics()">Обновить статистику</button>
                            <button class="btn btn-success" onclick="exportStatisticsToPDF()">Экспорт в PDF</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalRevenue">0 RSD</div>
                    <div class="stat-label">Общая выручка</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalInvoices">0</div>
                    <div class="stat-label">Всего инвойсов</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalClients">0</div>
                    <div class="stat-label">Клиентов</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="averageOrder">0 RSD</div>
                    <div class="stat-label">Средний заказ</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Выручка по месяцам</div>
                <div class="chart-placeholder" id="revenueChart">
                    График выручки будет отображен здесь
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Топ товаров по продажам</div>
                <div class="chart-placeholder" id="productsChart">
                    График продаж товаров будет отображен здесь
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Топ клиентов по выручке</div>
                <div class="chart-placeholder" id="clientsChart">
                    График клиентов будет отображен здесь
                </div>
            </div>

            <div class="invoice-list">
                <h3>Утвержденные инвойсы</h3>
                <div id="confirmedInvoicesList">
                    <p style="text-align: center; color: #666;">Нет утвержденных инвойсов</p>
                </div>
            </div>

            <div class="export-section" id="exportSection" style="display: none;">
                <h3>Предпросмотр отчета для экспорта</h3>
                <div id="pdfPreview" class="pdf-preview"></div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" onclick="printStatistics()">Печать / Сохранить PDF</button>
                    <button class="btn btn-secondary" onclick="hideExportPreview()">Закрыть предпросмотр</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Инициализация данных
        let clients = [];
        let products = [];
        let confirmedInvoices = [];
        let currentInvoiceData = null;

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            loadInitialData();
            setCurrentDate();
            updateClientSelects();
            updateProductSelects();
            generateDocumentNumbers();
            initializeStatistics();
        });

        function loadInitialData() {
            // Загружаем сохраненных клиентов
            clients = [
                {
                    name: "SVDA DOO",
                    mb: "22058282",
                    pib: "114703885",
                    address: "Београд, Стари Град, Мајке Јевросиме 19",
                    contact: "",
                    bank: ""
                },
                {
                    name: "AUDITORIA DOO BEOGRAD",
                    mb: "22043277",
                    pib: "114586673",
                    address: "Војводе Добрњца 48, Београд 11000",
                    contact: "",
                    bank: "190-0000000097100 (Алта банка А.Д.)"
                },
                {
                    name: "Aleksandra Tarasenko PR (Seal & Tea)",
                    mb: "67249208",
                    pib: "114000935",
                    address: "Нови Сад, Масарикова 18",
                    contact: "Курирская служба",
                    bank: ""
                },
                {
                    name: "Vera Organic Coffee and Tea doo Beograd",
                    mb: "21886866",
                    pib: "113543561",
                    address: "Николе Спасића 4, Стари Град, Београд",
                    contact: "avmofficebg@gmail.com, 063/773-6698, 062/168-4962",
                    bank: ""
                },
                {
                    name: "ČETIRI COFFEE DOO",
                    mb: "22057146",
                    pib: "114695557",
                    address: "Београд (Стари Град), Теразије 36",
                    contact: "",
                    bank: ""
                },
                {
                    name: "SOHAM DOO BEOGRAD",
                    mb: "21906654",
                    pib: "113646578",
                    address: "11000, Belgrade, Stari Grad, Kralja Milana st. 10a, 5th floor, apartment 15",
                    contact: "",
                    bank: ""
                },
                {
                    name: "Lako lounge (DOO LAKOO 011 DOO BEOGRAD)",
                    mb: "22060961",
                    pib: "114721018",
                    address: "Страхинића Бана 71, Београд, 11000",
                    contact: "",
                    bank: "190000000011284094"
                },
                {
                    name: "Klikermat d.o.o",
                    mb: "21204196",
                    pib: "109575389",
                    address: "Вардарска 23, 11000 Београд",
                    contact: "",
                    bank: ""
                },
                {
                    name: "Polako Smoke (DOO POLAKOO SMOKE)",
                    mb: "21899976",
                    pib: "113613419",
                    address: "Македонска 5, Београд 11000",
                    contact: "",
                    bank: "1905499014"
                },
                {
                    name: "DOOMAĆA DOO BEOGRAD",
                    mb: "22100785",
                    pib: "114989594",
                    address: "Београд, Звездара, Живка Карабиберовића 3",
                    contact: "Сопствени превоз",
                    bank: ""
                },
                {
                    name: "Andrei Ivanov pr (CHESTER SMOKE BAR)",
                    mb: "67592107",
                    pib: "114459677",
                    address: "Нови Сад, Трг Републике 19",
                    contact: "Сопствени превоз",
                    bank: ""
                },
                {
                    name: "Nekabudevino DOO",
                    mb: "67249208",
                    pib: "114000935",
                    address: "Београд, Краља Милана 4",
                    contact: "",
                    bank: ""
                }
            ];

            // Загружаем примеры товаров
            products = [
                {
                    code: "GF-B-TG210",
                    name: "Tieguanyin/Zeleni Čaj 210g",
                    price: 2297,
                    category: "Zeleni Čaj"
                },
                {
                    code: "GF-B-EG210",
                    name: "Earl Grey/Crni Čaj 210g",
                    price: 1850,
                    category: "Crni Čaj"
                },
                {
                    code: "GF-G-JG210",
                    name: "Jasmine Green Beverage/Zeleni Čaj 210g",
                    price: 1837,
                    category: "Zeleni Čaj"
                },
                {
                    code: "GF-G-SN210",
                    name: "Sencha/Zeleni Čaj 210g",
                    price: 1575,
                    category: "Zeleni Čaj"
                },
                {
                    code: "GF-B-MO210",
                    name: "Milky Oolong/Zeleni Čaj 210g",
                    price: 2167,
                    category: "Zeleni Čaj"
                },
                {
                    code: "CHC-G-MPC25-5",
                    name: "Golden tocha round Pu Erh/Crni Čaj 5g",
                    price: 88,
                    category: "Crni Čaj"
                },
                {
                    code: "CHC-B-LS210",
                    name: "Lapsang Souchong Black Tea/Crni Čaj 210g",
                    price: 2100,
                    category: "Crni Čaj"
                },
                {
                    code: "FJN-B-DHP210",
                    name: "Da Hong Pao/Crni Čaj 210g",
                    price: 2691,
                    category: "Crni Čaj"
                },
                {
                    code: "GF-B-KM210",
                    name: "Keemum/Crni Čaj 210g",
                    price: 1950,
                    category: "Crni Čaj"
                },
                {
                    code: "PRT-NP-Brs",
                    name: "Broshura Menu 190x270",
                    price: 473,
                    category: "Printing"
                },
                {
                    code: "PRT-NP-StcW",
                    name: "Stickers PVC white",
                    price: 15,
                    category: "Printing"
                },
                {
                    code: "PRT-NP-StcC",
                    name: "Stickers PVC clear",
                    price: 15,
                    category: "Printing"
                }
            ];

            renderClientsTable();
            renderProductsTable();
        }

        function setCurrentDate() {
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            const nextWeekStr = nextWeek.toISOString().split('T')[0];

            document.getElementById('invoiceDate').value = today;
            document.getElementById('invoiceDueDate').value = nextWeekStr;
            document.getElementById('deliveryDate').value = today;
            document.getElementById('deliveryDueDate').value = nextWeekStr;
        }

        function generateDocumentNumbers() {
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const dateStr = `${day}${month}${year}`;
            
            document.getElementById('invoiceNumber').value = `1-${dateStr}`;
            document.getElementById('deliveryNumber').value = `1-${dateStr}`;
        }

        function showTab(tabName) {
            // Скрыть все табы
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Показать выбранный таб
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.minWidth = '300px';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                document.body.removeChild(alertDiv);
            }, 3000);
        }

        // Управление клиентами
        function addClient() {
            const name = document.getElementById('clientName').value.trim();
            const mb = document.getElementById('clientMB').value.trim();
            const pib = document.getElementById('clientPIB').value.trim();
            const address = document.getElementById('clientAddress').value.trim();
            const contact = document.getElementById('clientContact').value.trim();
            const bank = document.getElementById('clientBank').value.trim();

            if (!name || !mb || !pib || !address) {
                showAlert('Пожалуйста, заполните все обязательные поля!', 'danger');
                return;
            }

            clients.push({
                name, mb, pib, address, contact, bank
            });

            clearClientForm();
            renderClientsTable();
            updateClientSelects();
            showAlert('Клиент успешно добавлен!', 'success');
        }

        function clearClientForm() {
            ['clientName', 'clientMB', 'clientPIB', 'clientAddress', 'clientContact', 'clientBank'].forEach(id => {
                document.getElementById(id).value = '';
            });
        }

        function deleteClient(index) {
            if (confirm('Вы уверены, что хотите удалить этого клиента?')) {
                clients.splice(index, 1);
                renderClientsTable();
                updateClientSelects();
                showAlert('Клиент удален!', 'success');
            }
        }

        function renderClientsTable() {
            const tbody = document.getElementById('clientsTableBody');
            tbody.innerHTML = '';

            clients.forEach((client, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${client.name}</strong></td>
                    <td>${client.mb}</td>
                    <td>${client.pib}</td>
                    <td style="max-width: 200px; word-wrap: break-word;">${client.address}</td>
                    <td>${client.contact}</td>
                    <td>${client.bank}</td>
                    <td><button class="btn btn-danger" onclick="deleteClient(${index})">Удалить</button></td>
                `;
            });
        }

        // Управление товарами
        function addProduct() {
            const code = document.getElementById('productCode').value.trim();
            const name = document.getElementById('productName').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const category = document.getElementById('productCategory').value;

            if (!code || !name || !price || price <= 0) {
                showAlert('Пожалуйста, заполните все обязательные поля корректно!', 'danger');
                return;
            }

            // Проверка на дублирование кода
            if (products.find(p => p.code === code)) {
                showAlert('Товар с таким кодом уже существует!', 'danger');
                return;
            }

            products.push({
                code, name, price, category
            });

            clearProductForm();
            renderProductsTable();
            updateProductSelects();
            showAlert('Товар успешно добавлен!', 'success');
        }

        function clearProductForm() {
            ['productCode', 'productName', 'productPrice', 'productCategory'].forEach(id => {
                document.getElementById(id).value = '';
            });
        }

        function deleteProduct(index) {
            if (confirm('Вы уверены, что хотите удалить этот товар?')) {
                products.splice(index, 1);
                renderProductsTable();
                updateProductSelects();
                showAlert('Товар удален!', 'success');
            }
        }

        function renderProductsTable() {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = '';

            products.forEach((product, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${product.code}</strong></td>
                    <td>${product.name}</td>
                    <td>${product.price.toFixed(2)} RSD</td>
                    <td>${product.category}</td>
                    <td><button class="btn btn-danger" onclick="deleteProduct(${index})">Удалить</button></td>
                `;
            });
        }

        function updateClientSelects() {
            const selects = ['invoiceClient', 'deliveryClient'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const currentValue = select.value;
                select.innerHTML = '<option value="">Выберите клиента</option>';
                clients.forEach((client, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = client.name;
                    select.appendChild(option);
                });
                select.value = currentValue;
            });
        }

        function updateProductSelects() {
            const containers = ['invoiceItemsContainer', 'deliveryItemsContainer'];
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                const selects = container.querySelectorAll('.invoice-product, .delivery-product');
                selects.forEach(select => {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">Выберите товар</option>';
                    products.forEach((product, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `${product.code} - ${product.name}`;
                        select.appendChild(option);
                    });
                    select.value = currentValue;
                });
            });
        }

        // Инвойсы
        function addInvoiceItem() {
            const container = document.getElementById('invoiceItemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'item-row';
            newItem.innerHTML = `
                <div class="form-group">
                    <label>Товар</label>
                    <select class="invoice-product" onchange="updateInvoiceItemPrice(this)">
                        <option value="">Выберите товар</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Количество</label>
                    <input type="number" class="invoice-quantity" value="1" min="1" onchange="calculateInvoiceItemAmount(this)">
                </div>
                <div class="form-group">
                    <label>Цена (RSD)</label>
                    <input type="number" class="invoice-price" step="0.01" readonly>
                </div>
                <div class="form-group">
                    <label>Сумма (RSD)</label>
                    <input type="number" class="invoice-amount" step="0.01" readonly>
                </div>
                <div>
                    <button class="btn btn-danger" onclick="removeInvoiceItem(this)">Удалить</button>
                </div>
            `;
            container.appendChild(newItem);
            updateProductSelects();
        }

        function removeInvoiceItem(button) {
            const container = document.getElementById('invoiceItemsContainer');
            if (container.children.length > 1) {
                button.closest('.item-row').remove();
                calculateInvoiceTotals();
            } else {
                showAlert('Должен остаться хотя бы один товар!', 'danger');
            }
        }

        function updateInvoiceItemPrice(select) {
            const row = select.closest('.item-row');
            const priceInput = row.querySelector('.invoice-price');
            const quantityInput = row.querySelector('.invoice-quantity');
            
            if (select.value !== '') {
                const product = products[select.value];
                priceInput.value = product.price.toFixed(2);
                calculateInvoiceItemAmount(quantityInput);
            } else {
                priceInput.value = '';
                row.querySelector('.invoice-amount').value = '';
            }
            calculateInvoiceTotals();
        }

        function calculateInvoiceItemAmount(quantityInput) {
            const row = quantityInput.closest('.item-row');
            const price = parseFloat(row.querySelector('.invoice-price').value) || 0;
            const quantity = parseInt(quantityInput.value) || 0;
            const amount = price * quantity;
            row.querySelector('.invoice-amount').value = amount.toFixed(2);
            calculateInvoiceTotals();
        }

        function calculateInvoiceTotals() {
            const amounts = document.querySelectorAll('#invoiceItemsContainer .invoice-amount');
            let subtotal = 0;
            
            amounts.forEach(input => {
                subtotal += parseFloat(input.value) || 0;
            });

            const vatRate = parseFloat(document.getElementById('invoiceVAT').value) || 0;
            const vatAmount = subtotal * (vatRate / 100);
            const total = subtotal + vatAmount;

            document.getElementById('invoiceSubtotal').textContent = subtotal.toFixed(2) + ' RSD';
            document.getElementById('invoiceVATAmount').textContent = vatAmount.toFixed(2) + ' RSD';
            document.getElementById('invoiceTotal').textContent = total.toFixed(2) + ' RSD';
        }

        // Обработчики событий для пересчета при изменении НДС
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('invoiceVAT').addEventListener('change', calculateInvoiceTotals);
        });

        function generateInvoice() {
            const invoiceNumber = document.getElementById('invoiceNumber').value.trim();
            const invoiceDate = document.getElementById('invoiceDate').value;
            const invoiceDueDate = document.getElementById('invoiceDueDate').value;
            const clientIndex = document.getElementById('invoiceClient').value;
            const delivery = document.getElementById('invoiceDelivery').value;
            const vatRate = document.getElementById('invoiceVAT').value;

            if (!invoiceNumber || !invoiceDate || !invoiceDueDate || clientIndex === '') {
                showAlert('Пожалуйста, заполните все обязательные поля!', 'danger');
                return;
            }

            const client = clients[clientIndex];
            const items = getInvoiceItems();
            
            if (items.length === 0) {
                showAlert('Добавьте хотя бы один товар!', 'danger');
                return;
            }

            const invoice = generateInvoiceHTML(invoiceNumber, invoiceDate, invoiceDueDate, client, items, delivery, vatRate);
            
            document.getElementById('invoiceContent').innerHTML = invoice;
            document.getElementById('invoicePreview').style.display = 'block';
            document.getElementById('invoicePreview').scrollIntoView({ behavior: 'smooth' });
            
            // Сохраняем данные текущего инвойса для утверждения
            currentInvoiceData = {
                number: invoiceNumber,
                date: invoiceDate,
                dueDate: invoiceDueDate,
                client: client,
                items: items,
                delivery: delivery,
                vatRate: parseFloat(vatRate),
                subtotal: items.reduce((sum, item) => sum + item.amount, 0),
                vatAmount: items.reduce((sum, item) => sum + item.amount, 0) * (parseFloat(vatRate) / 100),
                total: items.reduce((sum, item) => sum + item.amount, 0) * (1 + parseFloat(vatRate) / 100)
            };
            
            // Скрываем сообщение об утверждении
            document.getElementById('invoiceConfirmMessage').style.display = 'none';
        }

        function getInvoiceItems() {
            const items = [];
            const rows = document.querySelectorAll('#invoiceItemsContainer .item-row');
            
            rows.forEach(row => {
                const productSelect = row.querySelector('.invoice-product');
                const quantity = row.querySelector('.invoice-quantity').value;
                const price = row.querySelector('.invoice-price').value;
                const amount = row.querySelector('.invoice-amount').value;
                
                if (productSelect.value !== '' && quantity && price) {
                    const product = products[productSelect.value];
                    items.push({
                        code: product.code,
                        name: product.name,
                        quantity: parseInt(quantity),
                        price: parseFloat(price),
                        amount: parseFloat(amount)
                    });
                }
            });
            
            return items;
        }

        function generateInvoiceHTML(number, date, dueDate, client, items, delivery, vatRate) {
            const subtotal = items.reduce((sum, item) => sum + item.amount, 0);
            const vatAmount = subtotal * (parseFloat(vatRate) / 100);
            const total = subtotal + vatAmount;
            
            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('sr-RS');
            };

            let itemsHTML = '';
            items.forEach(item => {
                itemsHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">${item.code}/${item.name}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center">${item.quantity}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right">${item.price.toFixed(2)} RSD</td>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right">${item.amount.toFixed(2)} RSD</td>
                    </tr>
                `;
            });

            return `
                <div style="max-width: 800px; margin: 0 auto; padding: 30px; font-family: Arial, sans-serif; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px;">
                        <div>
                            <h1 style="margin: 0; font-size: 28px; color: #333;">Среħа 2024 ДОО</h1>
                            <p style="margin: 5px 0 0 0; color: #666; font-size: 16px;">Београд (Стари Град)</p>
                            <p style="margin: 5px 0; font-size: 14px;">Матични број: 22019309</p>
                            <p style="margin: 5px 0; font-size: 14px;">ПИБ: 114407658</p>
                            <p style="margin: 5px 0; font-size: 14px;">Седиште: Београд, Стари Град, Мајке Јевросиме 35</p>
                        </div>
                        <div style="text-align: right;">
                            <h2 style="margin: 0; font-size: 36px; color: #666;">Račun</h2>
                            <p style="margin: 10px 0; color: #888; font-size: 16px;"># ${number}</p>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Date:</strong> ${formatDate(date)}</p>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Due Date:</strong> ${formatDate(dueDate)}</p>
                            <p style="margin: 15px 0 5px 0; font-size: 16px; font-weight: bold; color: #007bff;"><strong>Balance Due:</strong> ${total.toFixed(2)} RSD</p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <div>
                            <h4 style="margin: 0 0 15px 0; color: #333;">Поручиoc:</h4>
                            <p style="margin: 5px 0; font-weight: bold;">${client.name}</p>
                            <p style="margin: 5px 0; font-size: 13px;">Матични број: ${client.mb}</p>
                            <p style="margin: 5px 0; font-size: 13px;">ПИБ: ${client.pib}</p>
                            <p style="margin: 5px 0; font-size: 13px;">Седиште: ${client.address}</p>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 15px 0; color: #333;">Isporuka na adresu:</h4>
                            <p style="margin: 5px 0; font-size: 13px;">${client.address}</p>
                            <p style="margin: 15px 0 5px 0; font-size: 13px;"><strong>Način:</strong> ${delivery}</p>
                        </div>
                    </div>

                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px; border: 2px solid #333;">
                        <thead>
                            <tr>
                                <th style="background: #333; color: white; padding: 12px; text-align: left;">Proizvod</th>
                                <th style="background: #333; color: white; padding: 12px; text-align: center;">količina</th>
                                <th style="background: #333; color: white; padding: 12px; text-align: center;">cena</th>
                                <th style="background: #333; color: white; padding: 12px; text-align: center;">iznos</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>

                    <div style="text-align: right; margin-bottom: 30px;">
                        <p style="margin: 5px 0; font-size: 16px;"><strong>Subtotal:</strong> ${subtotal.toFixed(2)} RSD</p>
                        <p style="margin: 5px 0; font-size: 16px;"><strong>PDV (${vatRate}%):</strong> ${vatAmount.toFixed(2)} RSD</p>
                        <p style="margin: 15px 0 5px 0; font-size: 18px; font-weight: bold; color: #007bff; border-top: 2px solid #007bff; padding-top: 10px;"><strong>Total:</strong> ${total.toFixed(2)} RSD</p>
                    </div>

                    <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                        <h4 style="margin: 0 0 10px 0;">Podaci o računima za prijem naknade:</h4>
                        <p style="margin: 5px 0; font-size: 14px;">Broj računa: 190-0000000085540-29</p>
                        <p style="margin: 5px 0; font-size: 14px;">Kod: Alta Banka ad Beograd</p>
                        <p style="margin: 5px 0; font-size: 14px;">Adresa banke: Beograd, Novi Beograd, Bulevar Zorana Đinđića 121</p>
                    </div>
                </div>
            `;
        }

        function printInvoice() {
            window.print();
        }

        function generateDeliveryFromInvoice() {
            const invoiceNumber = document.getElementById('invoiceNumber').value.trim();
            const invoiceDate = document.getElementById('invoiceDate').value;
            const invoiceDueDate = document.getElementById('invoiceDueDate').value;
            const clientIndex = document.getElementById('invoiceClient').value;
            const delivery = document.getElementById('invoiceDelivery').value;

            if (!invoiceNumber || !invoiceDate || !invoiceDueDate || clientIndex === '') {
                showAlert('Сначала заполните данные инвойса!', 'danger');
                return;
            }

            const items = getInvoiceItems();
            if (items.length === 0) {
                showAlert('Добавьте товары в инвойс!', 'danger');
                return;
            }

            // Переключиться на таб отпремницы
            showTab('delivery');
            
            // Заполнить данные
            document.getElementById('deliveryNumber').value = invoiceNumber;
            document.getElementById('deliveryDate').value = invoiceDate;
            document.getElementById('deliveryDueDate').value = invoiceDueDate;
            document.getElementById('deliveryClient').value = clientIndex;
            document.getElementById('deliveryMethod').value = delivery;

            // Очистить текущие товары в отпремнице
            const container = document.getElementById('deliveryItemsContainer');
            container.innerHTML = '';

            // Добавить товары из инвойса
            items.forEach((item, index) => {
                const productIndex = products.findIndex(p => p.code === item.code);
                
                const newItem = document.createElement('div');
                newItem.className = 'delivery-item-row';
                newItem.innerHTML = `
                    <div class="form-group">
                        <label>Товар</label>
                        <select class="delivery-product">
                            <option value="">Выберите товар</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Количество</label>
                        <input type="number" class="delivery-quantity" value="${item.quantity}" min="1">
                    </div>
                    <div class="form-group">
                        <label>Единица</label>
                        <input type="text" class="delivery-unit" value="ком" readonly>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="removeDeliveryItem(this)">Удалить</button>
                    </div>
                `;
                container.appendChild(newItem);
                
                // Заполнить селект товаров
                const select = newItem.querySelector('.delivery-product');
                products.forEach((product, idx) => {
                    const option = document.createElement('option');
                    option.value = idx;
                    option.textContent = `${product.code} - ${product.name}`;
                    select.appendChild(option);
                });
                
                // Установить выбранный товар
                if (productIndex !== -1) {
                    select.value = productIndex;
                }
            });

            showAlert('Данные инвойса скопированы в отпремницу!', 'success');
        }

        // Отпремницы
        function addDeliveryItem() {
            const container = document.getElementById('deliveryItemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'delivery-item-row';
            newItem.innerHTML = `
                <div class="form-group">
                    <label>Товар</label>
                    <select class="delivery-product">
                        <option value="">Выберите товар</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Количество</label>
                    <input type="number" class="delivery-quantity" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>Единица</label>
                    <input type="text" class="delivery-unit" value="ком" readonly>
                </div>
                <div>
                    <button class="btn btn-danger" onclick="removeDeliveryItem(this)">Удалить</button>
                </div>
            `;
            container.appendChild(newItem);
            updateProductSelects();
        }

        function removeDeliveryItem(button) {
            const container = document.getElementById('deliveryItemsContainer');
            if (container.children.length > 1) {
                button.closest('.delivery-item-row').remove();
            } else {
                showAlert('Должен остаться хотя бы один товар!', 'danger');
            }
        }

        function generateDelivery() {
            const deliveryNumber = document.getElementById('deliveryNumber').value.trim();
            const deliveryDate = document.getElementById('deliveryDate').value;
            const deliveryDueDate = document.getElementById('deliveryDueDate').value;
            const clientIndex = document.getElementById('deliveryClient').value;
            const method = document.getElementById('deliveryMethod').value;

            if (!deliveryNumber || !deliveryDate || !deliveryDueDate || clientIndex === '') {
                showAlert('Пожалуйста, заполните все обязательные поля!', 'danger');
                return;
            }

            const client = clients[clientIndex];
            const items = getDeliveryItems();
            
            if (items.length === 0) {
                showAlert('Добавьте хотя бы один товар!', 'danger');
                return;
            }

            const delivery = generateDeliveryHTML(deliveryNumber, deliveryDate, deliveryDueDate, client, items, method);
            
            document.getElementById('deliveryContent').innerHTML = delivery;
            document.getElementById('deliveryPreview').style.display = 'block';
            document.getElementById('deliveryPreview').scrollIntoView({ behavior: 'smooth' });
        }

        function getDeliveryItems() {
            const items = [];
            const rows = document.querySelectorAll('#deliveryItemsContainer .delivery-item-row');
            
            rows.forEach(row => {
                const productSelect = row.querySelector('.delivery-product');
                const quantity = row.querySelector('.delivery-quantity').value;
                const unit = row.querySelector('.delivery-unit').value;
                
                if (productSelect.value !== '' && quantity) {
                    const product = products[productSelect.value];
                    items.push({
                        code: product.code,
                        name: product.name,
                        quantity: parseInt(quantity),
                        unit: unit
                    });
                }
            });
            
            return items;
        }

        function generateDeliveryHTML(number, date, dueDate, client, items, method) {
            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('sr-RS');
            };

            let itemsHTML = '';
            items.forEach(item => {
                itemsHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">${item.code}/${item.name}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center">${item.quantity}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center">${item.unit}</td>
                    </tr>
                `;
            });

            return `
                <div style="max-width: 800px; margin: 0 auto; padding: 30px; font-family: Arial, sans-serif; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px;">
                        <div>
                            <h1 style="margin: 0; font-size: 28px; color: #333;">Среħа 2024 ДОО</h1>
                            <p style="margin: 5px 0 0 0; color: #666; font-size: 16px;">Београд (Стари Град)</p>
                            <p style="margin: 5px 0; font-size: 14px;">Матични број: 22019309</p>
                            <p style="margin: 5px 0; font-size: 14px;">ПИБ: 114407658</p>
                            <p style="margin: 5px 0; font-size: 14px;">Седиште: Београд, Стари Град, Мајке Јевросиме 35</p>
                        </div>
                        <div style="text-align: right;">
                            <h2 style="margin: 0; font-size: 36px; color: #666;">Отпремница</h2>
                            <p style="margin: 10px 0; color: #888; font-size: 16px;"># ${number}</p>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Датум:</strong> ${formatDate(date)}</p>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Рок испоруке:</strong> ${formatDate(dueDate)}</p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <div style="padding: 20px; border: 1px solid #ddd; border-radius: 6px; background: #fafafa;">
                            <h4 style="margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px;">Поручилац:</h4>
                            <p style="margin: 5px 0; font-weight: bold;">${client.name}</p>
                            <p style="margin: 5px 0; font-size: 13px;">Матични број: ${client.mb}</p>
                            <p style="margin: 5px 0; font-size: 13px;">ПИБ: ${client.pib}</p>
                            <p style="margin: 5px 0; font-size: 13px;">Седиште: ${client.address}</p>
                        </div>
                        <div style="padding: 20px; border: 1px solid #ddd; border-radius: 6px; background: #fafafa;">
                            <h4 style="margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px;">Испорука на адресу:</h4>
                            <p style="margin: 5px 0; font-size: 13px;">${client.address}</p>
                        </div>
                    </div>

                    <div style="margin-bottom: 30px; padding: 15px; background: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 4px;">
                        <strong>Начин испоруке:</strong> ${method}
                    </div>

                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px; border: 2px solid #333;">
                        <thead>
                            <tr>
                                <th style="background: #333; color: white; padding: 12px; text-align: left;">Назив артикла</th>
                                <th style="background: #333; color: white; padding: 12px; text-align: center;">Количина</th>
                                <th style="background: #333; color: white; padding: 12px; text-align: center;">Јединица мере</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 50px; margin-top: 50px; padding-top: 30px; border-top: 1px solid #ddd;">
                        <div style="text-align: center;">
                            <div style="border-bottom: 2px solid #333; margin-bottom: 8px; height: 30px;"></div>
                            <div><strong>Издао</strong></div>
                        </div>
                        <div style="text-align: center;">
                            <div style="border-bottom: 2px solid #333; margin-bottom: 8px; height: 30px;"></div>
                            <div><strong>Примио</strong></div>
                        </div>
                    </div>

                    <div style="margin-top: 30px; text-align: center; font-size: 12px; color: #666;">
                        Овај документ је генерисан електронски и важи без печата и потписа
                    </div>
                </div>
            `;
        }

        function printDelivery() {
            window.print();
        }

        // Добавляем обработчики событий для автоматического пересчета
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('invoice-quantity')) {
                calculateInvoiceItemAmount(e.target);
            }
        });

        // Функции для статистики
        function initializeStatistics() {
            const today = new Date();
            const firstDayOfYear = new Date(today.getFullYear(), 0, 1);
            
            document.getElementById('statsFromDate').value = firstDayOfYear.toISOString().split('T')[0];
            document.getElementById('statsToDate').value = today.toISOString().split('T')[0];
            
            updateStatistics();
        }

        function confirmInvoice() {
            if (!currentInvoiceData) {
                showAlert('Нет данных инвойса для утверждения!', 'danger');
                return;
            }

            // Проверяем, не утвержден ли уже этот инвойс
            if (confirmedInvoices.find(inv => inv.number === currentInvoiceData.number)) {
                showAlert('Этот инвойс уже утвержден!', 'danger');
                return;
            }

            // Добавляем инвойс в утвержденные
            confirmedInvoices.push({
                ...currentInvoiceData,
                confirmedDate: new Date().toISOString()
            });

            // Показываем сообщение об успехе
            document.getElementById('invoiceConfirmMessage').style.display = 'block';
            
            // Обновляем статистику
            updateStatistics();
            
            showAlert('Инвойс успешно утвержден!', 'success');
        }

        function removeInvoiceFromStats(invoiceNumber) {
            if (confirm('Вы уверены, что хотите удалить этот инвойс из статистики?')) {
                confirmedInvoices = confirmedInvoices.filter(inv => inv.number !== invoiceNumber);
                updateStatistics();
                showAlert('Инвойс удален из статистики!', 'success');
            }
        }

        function updateStatistics() {
            const fromDate = new Date(document.getElementById('statsFromDate').value);
            const toDate = new Date(document.getElementById('statsToDate').value);
            toDate.setHours(23, 59, 59, 999); // Конец дня
            
            // Фильтруем инвойсы по периоду
            const filteredInvoices = confirmedInvoices.filter(invoice => {
                const invoiceDate = new Date(invoice.date);
                return invoiceDate >= fromDate && invoiceDate <= toDate;
            });

            // Вычисляем общую статистику
            const totalRevenue = filteredInvoices.reduce((sum, inv) => sum + inv.total, 0);
            const totalInvoicesCount = filteredInvoices.length;
            const uniqueClients = new Set(filteredInvoices.map(inv => inv.client.name)).size;
            const averageOrder = totalInvoicesCount > 0 ? totalRevenue / totalInvoicesCount : 0;

            // Обновляем карточки статистики
            document.getElementById('totalRevenue').textContent = totalRevenue.toFixed(2) + ' RSD';
            document.getElementById('totalInvoices').textContent = totalInvoicesCount;
            document.getElementById('totalClients').textContent = uniqueClients;
            document.getElementById('averageOrder').textContent = averageOrder.toFixed(2) + ' RSD';

            // Обновляем графики
            updateRevenueChart(filteredInvoices);
            updateProductsChart(filteredInvoices);
            updateClientsChart(filteredInvoices);
            
            // Обновляем список инвойсов
            updateInvoicesList(filteredInvoices);
        }

        function updateRevenueChart(invoices) {
            const monthlyData = {};
            
            invoices.forEach(invoice => {
                const date = new Date(invoice.date);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[monthKey] = (monthlyData[monthKey] || 0) + invoice.total;
            });

            let chartHTML = '<div style="display: flex; align-items: end; height: 250px; gap: 10px; padding: 20px;">';
            
            if (Object.keys(monthlyData).length === 0) {
                chartHTML = '<div style="text-align: center; padding: 50px; color: #666;">Нет данных за выбранный период</div>';
            } else {
                const maxValue = Math.max(...Object.values(monthlyData));
                const months = ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'];
                
                Object.entries(monthlyData).forEach(([monthKey, value]) => {
                    const [year, month] = monthKey.split('-');
                    const monthName = months[parseInt(month) - 1];
                    const height = (value / maxValue) * 200;
                    
                    chartHTML += `
                        <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                            <div style="font-size: 12px; margin-bottom: 5px; font-weight: bold;">${value.toFixed(0)} RSD</div>
                            <div style="width: 40px; height: ${height}px; background: linear-gradient(to top, #007bff, #0056b3); border-radius: 4px 4px 0 0;"></div>
                            <div style="font-size: 12px; margin-top: 5px; text-align: center;">${monthName}<br>${year}</div>
                        </div>
                    `;
                });
            }
            
            chartHTML += '</div>';
            document.getElementById('revenueChart').innerHTML = chartHTML;
        }

        function updateProductsChart(invoices) {
            const productData = {};
            
            invoices.forEach(invoice => {
                invoice.items.forEach(item => {
                    const key = item.code;
                    if (!productData[key]) {
                        productData[key] = {
                            name: item.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    productData[key].quantity += item.quantity;
                    productData[key].revenue += item.amount;
                });
            });

            const sortedProducts = Object.entries(productData)
                .sort((a, b) => b[1].revenue - a[1].revenue)
                .slice(0, 10); // Топ 10 товаров

            let chartHTML = '';
            
            if (sortedProducts.length === 0) {
                chartHTML = '<div style="text-align: center; padding: 50px; color: #666;">Нет данных за выбранный период</div>';
            } else {
                const maxRevenue = sortedProducts[0][1].revenue;
                
                chartHTML = '<div style="padding: 20px;">';
                sortedProducts.forEach(([code, data]) => {
                    const percentage = (data.revenue / maxRevenue) * 100;
                    chartHTML += `
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="font-weight: bold; font-size: 14px;">${code}</span>
                                <span style="font-size: 14px;">${data.revenue.toFixed(2)} RSD (${data.quantity} шт)</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: #e9ecef; border-radius: 4px;">
                                <div style="width: ${percentage}%; height: 100%; background: linear-gradient(to right, #28a745, #20c997); border-radius: 4px;"></div>
                            </div>
                        </div>
                    `;
                });
                chartHTML += '</div>';
            }
            
            document.getElementById('productsChart').innerHTML = chartHTML;
        }

        function updateClientsChart(invoices) {
            const clientData = {};
            
            invoices.forEach(invoice => {
                const clientName = invoice.client.name;
                clientData[clientName] = (clientData[clientName] || 0) + invoice.total;
            });

            const sortedClients = Object.entries(clientData)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10); // Топ 10 клиентов

            let chartHTML = '';
            
            if (sortedClients.length === 0) {
                chartHTML = '<div style="text-align: center; padding: 50px; color: #666;">Нет данных за выбранный период</div>';
            } else {
                const maxRevenue = sortedClients[0][1];
                
                chartHTML = '<div style="padding: 20px;">';
                sortedClients.forEach(([clientName, revenue]) => {
                    const percentage = (revenue / maxRevenue) * 100;
                    chartHTML += `
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="font-weight: bold; font-size: 14px;">${clientName}</span>
                                <span style="font-size: 14px;">${revenue.toFixed(2)} RSD</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: #e9ecef; border-radius: 4px;">
                                <div style="width: ${percentage}%; height: 100%; background: linear-gradient(to right, #007bff, #0056b3); border-radius: 4px;"></div>
                            </div>
                        </div>
                    `;
                });
                chartHTML += '</div>';
            }
            
            document.getElementById('clientsChart').innerHTML = chartHTML;
        }

        function updateInvoicesList(invoices) {
            const container = document.getElementById('confirmedInvoicesList');
            
            if (invoices.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Нет утвержденных инвойсов за выбранный период</p>';
                return;
            }

            let listHTML = '';
            invoices.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(invoice => {
                const date = new Date(invoice.date).toLocaleDateString('sr-RS');
                listHTML += `
                    <div class="invoice-item">
                        <div class="invoice-info">
                            <div style="font-weight: bold; color: #007bff;">Инвойс #${invoice.number}</div>
                            <div style="font-size: 14px; color: #666; margin-top: 5px;">
                                ${invoice.client.name} • ${date} • ${invoice.total.toFixed(2)} RSD
                            </div>
                            <div style="font-size: 12px; color: #888; margin-top: 3px;">
                                Товаров: ${invoice.items.length} • НДС: ${invoice.vatRate}%
                            </div>
                        </div>
                        <div class="invoice-actions">
                            <span class="invoice-status status-confirmed">Утвержден</span>
                            <button class="btn btn-remove" onclick="removeInvoiceFromStats('${invoice.number}')">Удалить</button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = listHTML;
        }

        function exportStatisticsToPDF() {
            const fromDate = document.getElementById('statsFromDate').value;
            const toDate = document.getElementById('statsToDate').value;
            
            if (!fromDate || !toDate) {
                showAlert('Пожалуйста, выберите период для экспорта!', 'danger');
                return;
            }

            // Фильтруем инвойсы по периоду
            const filteredInvoices = confirmedInvoices.filter(invoice => {
                const invoiceDate = new Date(invoice.date);
                const from = new Date(fromDate);
                const to = new Date(toDate);
                to.setHours(23, 59, 59, 999);
                return invoiceDate >= from && invoiceDate <= to;
            });

            if (filteredInvoices.length === 0) {
                showAlert('Нет данных для экспорта за выбранный период!', 'danger');
                return;
            }

            // Генерируем PDF-превью
            const pdfContent = generateStatisticsPDF(filteredInvoices, fromDate, toDate);
            document.getElementById('pdfPreview').innerHTML = pdfContent;
            document.getElementById('exportSection').style.display = 'block';
            document.getElementById('exportSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateStatisticsPDF(invoices, fromDate, toDate) {
            // Вычисляем статистику
            const totalRevenue = invoices.reduce((sum, inv) => sum + inv.total, 0);
            const totalInvoicesCount = invoices.length;
            const uniqueClients = new Set(invoices.map(inv => inv.client.name)).size;
            const averageOrder = totalInvoicesCount > 0 ? totalRevenue / totalInvoicesCount : 0;

            // Статистика по товарам
            const productData = {};
            invoices.forEach(invoice => {
                invoice.items.forEach(item => {
                    const key = item.code;
                    if (!productData[key]) {
                        productData[key] = {
                            name: item.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    productData[key].quantity += item.quantity;
                    productData[key].revenue += item.amount;
                });
            });

            const topProducts = Object.entries(productData)
                .sort((a, b) => b[1].revenue - a[1].revenue)
                .slice(0, 10);

            // Статистика по клиентам
            const clientData = {};
            invoices.forEach(invoice => {
                const clientName = invoice.client.name;
                clientData[clientName] = (clientData[clientName] || 0) + invoice.total;
            });

            const topClients = Object.entries(clientData)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            // Статистика по месяцам
            const monthlyData = {};
            invoices.forEach(invoice => {
                const date = new Date(invoice.date);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[monthKey] = (monthlyData[monthKey] || 0) + invoice.total;
            });

            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('sr-RS');
            };

            const months = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];

            return `
                <div style="max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif; color: #333;">
                    <!-- Заголовок отчета -->
                    <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #007bff; padding-bottom: 20px;">
                        <h1 style="margin: 0; color: #007bff; font-size: 32px;">Отчет по продажам</h1>
                        <h2 style="margin: 10px 0 0 0; color: #666; font-size: 24px;">Среħа 2024 ДОО</h2>
                        <p style="margin: 10px 0 0 0; color: #888; font-size: 16px;">
                            Период: ${formatDate(fromDate)} - ${formatDate(toDate)}
                        </p>
                        <p style="margin: 5px 0 0 0; color: #888; font-size: 14px;">
                            Сгенерировано: ${new Date().toLocaleDateString('sr-RS')} в ${new Date().toLocaleTimeString('sr-RS')}
                        </p>
                    </div>

                    <!-- Общая статистика -->
                    <div class="stats-summary">
                        <div class="summary-item">
                            <div class="summary-label">Общая выручка</div>
                            <div class="summary-value">${totalRevenue.toFixed(2)} RSD</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Количество инвойсов</div>
                            <div class="summary-value">${totalInvoicesCount}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Уникальных клиентов</div>
                            <div class="summary-value">${uniqueClients}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Средний заказ</div>
                            <div class="summary-value">${averageOrder.toFixed(2)} RSD</div>
                        </div>
                    </div>

                    <!-- Выручка по месяцам -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px;">Выручка по месяцам</h3>
                        <table class="table-stats">
                            <thead>
                                <tr>
                                    <th>Месяц</th>
                                    <th>Выручка (RSD)</th>
                                    <th>% от общей</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(monthlyData).map(([monthKey, revenue]) => {
                                    const [year, month] = monthKey.split('-');
                                    const monthName = months[parseInt(month) - 1];
                                    const percentage = ((revenue / totalRevenue) * 100).toFixed(1);
                                    return `
                                        <tr>
                                            <td>${monthName} ${year}</td>
                                            <td>${revenue.toFixed(2)}</td>
                                            <td>${percentage}%</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>

                    <!-- Топ товаров -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px;">Топ товаров по продажам</h3>
                        <table class="table-stats">
                            <thead>
                                <tr>
                                    <th>Код товара</th>
                                    <th>Название</th>
                                    <th>Количество</th>
                                    <th>Выручка (RSD)</th>
                                    <th>% от общей</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${topProducts.map(([code, data]) => {
                                    const percentage = ((data.revenue / totalRevenue) * 100).toFixed(1);
                                    return `
                                        <tr>
                                            <td><strong>${code}</strong></td>
                                            <td>${data.name}</td>
                                            <td>${data.quantity}</td>
                                            <td>${data.revenue.toFixed(2)}</td>
                                            <td>${percentage}%</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>

                    <!-- Топ клиентов -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px;">Топ клиентов по выручке</h3>
                        <table class="table-stats">
                            <thead>
                                <tr>
                                    <th>Клиент</th>
                                    <th>Выручка (RSD)</th>
                                    <th>% от общей</th>
                                    <th>Количество заказов</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${topClients.map(([clientName, revenue]) => {
                                    const percentage = ((revenue / totalRevenue) * 100).toFixed(1);
                                    const orderCount = invoices.filter(inv => inv.client.name === clientName).length;
                                    return `
                                        <tr>
                                            <td><strong>${clientName}</strong></td>
                                            <td>${revenue.toFixed(2)}</td>
                                            <td>${percentage}%</td>
                                            <td>${orderCount}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>

                    <!-- Список всех инвойсов -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px;">Детализация по инвойсам</h3>
                        <table class="table-stats">
                            <thead>
                                <tr>
                                    <th>Номер</th>
                                    <th>Дата</th>
                                    <th>Клиент</th>
                                    <th>Товаров</th>
                                    <th>Сумма (RSD)</th>
                                    <th>НДС</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${invoices.sort((a, b) => new Date(b.date) - new Date(a.date)).map(invoice => `
                                    <tr>
                                        <td><strong>${invoice.number}</strong></td>
                                        <td>${formatDate(invoice.date)}</td>
                                        <td>${invoice.client.name}</td>
                                        <td>${invoice.items.length}</td>
                                        <td>${invoice.total.toFixed(2)}</td>
                                        <td>${invoice.vatRate}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <!-- Подвал отчета -->
                    <div style="text-align: center; margin-top: 50px; padding-top: 20px; border-top: 2px solid #007bff; color: #666;">
                        <p style="margin: 0; font-size: 14px;">
                            <strong>Среħа 2024 ДОО</strong><br>
                            Београд, Стари Град, Мајке Јевросиме 35<br>
                            МБ: 22019309 | ПИБ: 114407658
                        </p>
                    </div>
                </div>
            `;
        }

        function printStatistics() {
            window.print();
        }

        function hideExportPreview() {
            document.getElementById('exportSection').style.display = 'none';
        }

        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('invoice-product')) {
                updateInvoiceItemPrice(e.target);
            }
            if (e.target.id === 'invoiceVAT') {
                calculateInvoiceTotals();
            }
        });
    </script>
</body>
</html>